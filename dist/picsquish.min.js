var Wk=Object.create;var{getPrototypeOf:Xk,defineProperty:s,getOwnPropertyNames:wk}=Object;var Yk=Object.prototype.hasOwnProperty;var Tk=(k,M,U)=>{U=k!=null?Wk(Xk(k)):{};let I=M||!k||!k.__esModule?s(U,"default",{value:k,enumerable:!0}):U;for(let Z of wk(k))if(!Yk.call(I,Z))s(I,Z,{get:()=>k[Z],enumerable:!0});return I};var Ek=(k,M)=>()=>(M||k((M={exports:{}}).exports,M),M.exports);var Bk=Ek((ik,jk)=>{var a,o,p,_,n,d,Jk,Zk;function Hk(k){if(k<0.5)k=0.5;var M=Math.exp(0.527076)/k,U=Math.exp(-M),I=Math.exp(-2*M),Z=(1-U)*(1-U)/(1+2*M*U-I);return a=Z,o=Z*(M-1)*U,p=Z*(M+1)*U,_=-Z*I,n=2*U,d=-I,Jk=(a+o)/(1-n-d),Zk=(p+_)/(1-n-d),new Float32Array([a,o,p,_,n,d,Jk,Zk])}function $k(k,M,U,I,Z,K){var Q,q,$,J,j,A,D,B,G,L,y,C,R,N,X,w,V,W,S,T,P,z,E,Y,v,h,F,H,m,O;for(v=0;v<K;v++){z=v*Z,E=v,Y=0,Q=k[z],q=Q&255,$=Q>>8&255,J=Q>>16&255,j=Q>>24&255,W=q*I[6],S=$*I[6],T=J*I[6],P=j*I[6],N=W,X=S,w=T,V=P,F=I[0],H=I[1],m=I[4],O=I[5];for(h=0;h<Z;h++)Q=k[z],A=Q&255,D=Q>>8&255,B=Q>>16&255,G=Q>>24&255,L=A*F+q*H+N*m+W*O,y=D*F+$*H+X*m+S*O,C=B*F+J*H+w*m+T*O,R=G*F+j*H+V*m+P*O,W=N,S=X,T=w,P=V,N=L,X=y,w=C,V=R,q=A,$=D,J=B,j=G,U[Y]=N,U[Y+1]=X,U[Y+2]=w,U[Y+3]=V,Y+=4,z++;z--,Y-=4,E+=K*(Z-1),Q=k[z],q=Q&255,$=Q>>8&255,J=Q>>16&255,j=Q>>24&255,W=q*I[7],S=$*I[7],T=J*I[7],P=j*I[7],N=W,X=S,w=T,V=P,A=q,D=$,B=J,G=j,F=I[2],H=I[3];for(h=Z-1;h>=0;h--)L=A*F+q*H+N*m+W*O,y=D*F+$*H+X*m+S*O,C=B*F+J*H+w*m+T*O,R=G*F+j*H+V*m+P*O,W=N,S=X,T=w,P=V,N=L,X=y,w=C,V=R,q=A,$=D,J=B,j=G,Q=k[z],A=Q&255,D=Q>>8&255,B=Q>>16&255,G=Q>>24&255,Q=(U[Y]+N<<0)+(U[Y+1]+X<<8)+(U[Y+2]+w<<16)+(U[Y+3]+V<<24),M[E]=Q,z--,Y-=4,E-=K}}function mk(k,M,U,I){if(!I)return;var Z=new Uint32Array(k.buffer),K=new Uint32Array(Z.length),Q=new Float32Array(Math.max(M,U)*4),q=Hk(I);$k(Z,K,Q,q,M,U,I),$k(K,Z,Q,q,U,M,I)}jk.exports=mk});function r(k,M,U,I,Z,K){let Q=U/k,q=I/M,$=(2*K+2+1)/Z;if($>0.5)return[[U,I]];let J=Math.ceil(Math.log(Math.min(Q,q))/Math.log($));if(J<=1)return[[U,I]];let j=[];for(let A=0;A<J;A++){let D=Math.round(Math.pow(Math.pow(k,J-A-1)*Math.pow(U,A+1),1/J)),B=Math.round(Math.pow(Math.pow(M,J-A-1)*Math.pow(I,A+1),1/J));j.push([D,B])}return j}function i(k,M,U,I,Z){let K=new OffscreenCanvas(k.width,k.height),Q=K.getContext("2d");if(!Q)throw new Error("Pica: Canvas context is not supported");return Q.globalCompositeOperation="copy",Q.drawImage(I.srcImageBitmap||M,k.x,k.y,k.width,k.height,0,0,k.width,k.height),Z.src=Q.getImageData(0,0,k.width,k.height).data,K.width=K.height=0,Z}var t=0.00001;function x(k){let M=Math.round(k);if(Math.abs(k-M)<t)return M;return Math.floor(k)}function e(k){let M=Math.round(k);if(Math.abs(k-M)<t)return M;return Math.ceil(k)}function kk(k){let M=k.toWidth/k.width,U=k.toHeight/k.height,I=x(k.srcTileSize*M)-2*k.destTileBorder,Z=x(k.srcTileSize*U)-2*k.destTileBorder;if(I<1||Z<1)throw new Error("Internal error in pica: target tile width/height is too small.");let K,Q,q,$,J,j,A=[],D;for($=0;$<k.toHeight;$+=Z)for(q=0;q<k.toWidth;q+=I){if(K=q-k.destTileBorder,K<0)K=0;if(J=q+I+k.destTileBorder-K,K+J>=k.toWidth)J=k.toWidth-K;if(Q=$-k.destTileBorder,Q<0)Q=0;if(j=$+Z+k.destTileBorder-Q,Q+j>=k.toHeight)j=k.toHeight-Q;D={toX:K,toY:Q,toWidth:J,toHeight:j,toInnerX:q,toInnerY:$,toInnerWidth:I,toInnerHeight:Z,offsetX:K/M-x(K/M),offsetY:Q/U-x(Q/U),scaleX:M,scaleY:U,x:x(K/M),y:x(Q/U),width:e(J/M),height:e(j/U)},A.push(D)}return A}var g={box:{win:0.5,fn:(k)=>{if(k<0)k=-k;return k<0.5?1:0}},hamming:{win:1,fn:(k)=>{if(k<0)k=-k;if(k>=1)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*(0.54+0.46*Math.cos(M/1))}},lanczos2:{win:2,fn:(k)=>{if(k<0)k=-k;if(k>=2)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*Math.sin(M/2)/(M/2)}},lanczos3:{win:3,fn:(k)=>{if(k<0)k=-k;if(k>=3)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*Math.sin(M/3)/(M/3)}},mks2013:{win:2.5,fn:(k)=>{if(k<0)k=-k;if(k>=2.5)return 0;if(k>=1.5)return-0.125*(k-2.5)*(k-2.5);if(k>=0.5)return 0.25*(4*k*k-11*k+7);return 1.0625-1.75*k*k}}};var Sk=14;function Mk(k){return Math.round(k*((1<<Sk)-1))}function f(k,M,U,I,Z){let K=g[k].fn,Q=1/I,q=Math.min(1,I),$=g[k].win/q,J,j,A,D,B,G,L,y,C,R,N,X,w,V,W,S,T,P=Math.floor(($+1)*2),z=new Int16Array((P+2)*U),E=0,Y=!z.subarray||!z.set;for(J=0;J<U;J++){j=(J+0.5)*Q+Z,A=Math.max(0,Math.floor(j-$)),D=Math.min(M-1,Math.ceil(j+$)),B=D-A+1,G=new Float32Array(B),L=new Int16Array(B),y=0;for(C=A,R=0;C<=D;C++,R++)N=K((C+0.5-j)*q),y+=N,G[R]=N;X=0;for(R=0;R<G.length;R++)w=G[R]/y,X+=w,L[R]=Mk(w);L[U>>1]+=Mk(1-X),V=0;while(V<L.length&&L[V]===0)V++;if(V<L.length){W=L.length-1;while(W>0&&L[W]===0)W--;if(S=A+V,T=W-V+1,z[E++]=S,z[E++]=T,!Y)z.set(L.subarray(V,W+1),E),E+=T;else for(R=V;R<=W;R++)z[E++]=L[R]}else z[E++]=0,z[E++]=0}return z}function b(k){return k<0?0:k>255?255:k}function u(k){return k>=0?k:0}function Ik(k,M,U,I,Z,K){let Q,q,$,J,j,A,D,B,G,L,y,C=0,R=0;for(G=0;G<I;G++){j=0;for(L=0;L<Z;L++){A=K[j++],D=K[j++],B=C+A*4|0,Q=q=$=J=0;for(;D>0;D--)y=K[j++],J=J+y*k[B+3]|0,$=$+y*k[B+2]|0,q=q+y*k[B+1]|0,Q=Q+y*k[B]|0,B=B+4|0;M[R+3]=u(J>>7),M[R+2]=u($>>7),M[R+1]=u(q>>7),M[R]=u(Q>>7),R=R+I*4|0}R=(G+1)*4|0,C=(G+1)*U*4|0}}function Qk(k,M,U,I,Z,K){let Q,q,$,J,j,A,D,B,G,L,y,C=0,R=0;for(G=0;G<I;G++){j=0;for(L=0;L<Z;L++){A=K[j++],D=K[j++],B=C+A*4|0,Q=q=$=J=0;for(;D>0;D--)y=K[j++],J=J+y*k[B+3]|0,$=$+y*k[B+2]|0,q=q+y*k[B+1]|0,Q=Q+y*k[B]|0,B=B+4|0;Q>>=7,q>>=7,$>>=7,J>>=7,M[R+3]=b(J+8192>>14),M[R+2]=b($+8192>>14),M[R+1]=b(q+8192>>14),M[R]=b(Q+8192>>14),R=R+I*4|0}R=(G+1)*4|0,C=(G+1)*U*4|0}}function Uk(k,M,U,I,Z,K){let Q,q,$,J,j,A,D,B,G,L,y,C,R=0,N=0;for(L=0;L<I;L++){A=0;for(y=0;y<Z;y++){D=K[A++],B=K[A++],G=R+D*4|0,Q=q=$=J=0;for(;B>0;B--)C=K[A++],j=k[G+3],J=J+C*j|0,$=$+C*k[G+2]*j|0,q=q+C*k[G+1]*j|0,Q=Q+C*k[G]*j|0,G=G+4|0;$=$/255|0,q=q/255|0,Q=Q/255|0,M[N+3]=u(J>>7),M[N+2]=u($>>7),M[N+1]=u(q>>7),M[N]=u(Q>>7),N=N+I*4|0}N=(L+1)*4|0,R=(L+1)*U*4|0}}function qk(k,M,U,I,Z,K){let Q,q,$,J,j,A,D,B,G,L,y,C=0,R=0;for(G=0;G<I;G++){j=0;for(L=0;L<Z;L++){A=K[j++],D=K[j++],B=C+A*4|0,Q=q=$=J=0;for(;D>0;D--)y=K[j++],J=J+y*k[B+3]|0,$=$+y*k[B+2]|0,q=q+y*k[B+1]|0,Q=Q+y*k[B]|0,B=B+4|0;if(Q>>=7,q>>=7,$>>=7,J>>=7,J=b(J+8192>>14),J>0)Q=Q*255/J|0,q=q*255/J|0,$=$*255/J|0;M[R+3]=J,M[R+2]=b($+8192>>14),M[R+1]=b(q+8192>>14),M[R]=b(Q+8192>>14),R=R+I*4|0}R=(G+1)*4|0,C=(G+1)*U*4|0}}function Pk(k,M,U){let I=3,Z=M*U*4|0;while(I<Z){if(k[I]!==255)return!0;I=I+4|0}return!1}function Fk(k,M,U){let I=3,Z=M*U*4|0;while(I<Z)k[I]=255,I=I+4|0}function Kk(k){let{src:M,width:U,height:I,toWidth:Z,toHeight:K}=k,Q=k.scaleX||k.toWidth/k.width,q=k.scaleY||k.toHeight/k.height,$=k.offsetX||0,J=k.offsetY||0,j=k.dest||new Uint8Array(Z*K*4),A=typeof k.filter==="undefined"?"mks2013":k.filter,D=f(A,U,Z,Q,$),B=f(A,I,K,q,J),G=new Uint16Array(Z*I*4);if(Pk(M,U,I))Uk(M,G,U,I,Z,D),qk(G,j,I,Z,K,B);else Ik(M,G,U,I,Z,D),Qk(G,j,I,Z,K,B),Fk(j,Z,K);return j}var Gk=Tk(Bk(),1);function Ok(k,M,U){let I=M*U,Z=new Uint16Array(I),K,Q,q,$;for(let J=0;J<I;J++)K=k[4*J],Q=k[4*J+1],q=k[4*J+2],$=K>=Q&&K>=q?K:Q>=q&&Q>=K?Q:q,Z[J]=$<<8;return Z}function Rk(k,M,U,I,Z,K){let Q,q,$,J,j;if(I===0||Z<0.5)return;if(Z>2)Z=2;let A=Ok(k,M,U),D=new Uint16Array(A);Gk.default(D,M,U,Z);let B=I/100*4096+0.5|0,G=K<<8,L=M*U;for(let y=0;y<L;y++)if(Q=A[y],J=Q-D[y],Math.abs(J)>=G)q=Q+(B*J+2048>>12),q=q>65280?65280:q,q=q<0?0:q,Q=Q!==0?Q:1,$=(q<<12)/Q|0,j=y*4,k[j]=k[j]*$+2048>>12,k[j+1]=k[j+1]*$+2048>>12,k[j+2]=k[j+2]*$+2048>>12}function Ak(k){let M=Kk(k);if(k.unsharpAmount)Rk(M,k.toWidth,k.toHeight,k.unsharpAmount,k.unsharpRadius,k.unsharpThreshold);return M}function Dk(k){return Promise.resolve().then(()=>{return{data:Ak(k)}})}function Lk(k,M,U){let I;if(I=new ImageData(new Uint8ClampedArray(M.data),k.toWidth,k.toHeight),!1)U.toCtx?.putImageData(I,k.toX,k.toY,k.toInnerX-k.toX,k.toInnerY-k.toY,k.toInnerWidth+0.00001,k.toInnerHeight+0.00001);else U.toCtx?.putImageData(I,k.toX,k.toY,k.toInnerX-k.toX,k.toInnerY-k.toY,k.toInnerWidth,k.toInnerHeight);return null}function yk(k){return k instanceof OffscreenCanvas}function Ck(k){return k instanceof ImageBitmap}var uk=(k,M,U,I)=>{let Z={width:k.width,height:k.height,toWidth:k.toWidth,toHeight:k.toHeight,scaleX:k.scaleX,scaleY:k.scaleY,offsetX:k.offsetX,offsetY:k.offsetY,filter:U.filter,unsharpAmount:U.unsharpAmount,unsharpRadius:U.unsharpRadius,unsharpThreshold:U.unsharpThreshold};return Promise.resolve(Z).then((K)=>i(k,M,null,I,K)).then((K)=>Dk(K)).then((K)=>Lk(k,K,I))};function Nk(k,M,U){let I={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(()=>{if(I.toCtx=M.getContext("2d"),yk(k))return null;if(Ck(k))return I.srcImageBitmap=k,I.isImageBitmapReused=!0,null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(()=>{let K=kk({width:U.width,height:U.height,srcTileSize:1024,toWidth:U.toWidth,toHeight:U.toHeight,destTileBorder:U.destTileBorder}).map((q)=>uk(q,k,U,I));function Q(q){if(q.srcImageBitmap){if(!q.isImageBitmapReused)q.srcImageBitmap.close();q.srcImageBitmap=null}}return Promise.all(K).then(()=>{return Q(I),M},(q)=>{throw Q(I),q})})}async function c(k,M,U,I){let[Z,K]=k.shift(),Q=k.length===0;I.toWidth=Z,I.toHeight=K;let q;if(!Q)q=new OffscreenCanvas(Z,K);if(await Nk(M,Q?U:q,I),Q)return U;I.width=Z,I.height=K;let $=await c(k,M,q,I);if(q)q.width=q.height=0;return $}async function Vk(k,M){let U=M.maxDimension,I=M.tileSize??1024,Z=M.unsharpAmount??0,K=M.unsharpRadius??0,Q=M.unsharpThreshold??0,q=await createImageBitmap(k),$=q.width,J=q.height,j=U/$,A=U/J,D=Math.min(j,A,1),B=Math.floor($*D),G=Math.floor(J*D),L=new OffscreenCanvas(B,G),y=3,C=Math.ceil(Math.max(3,2.5*K|0)),R=r($,J,B,G,I,C);return(await c(R,q,L,{filter:"mks2013",unsharpAmount:Z,unsharpRadius:K,unsharpThreshold:Q,width:$,height:J,toWidth:B,toHeight:G,destTileBorder:C})).transferToImageBitmap()}var hk=`
var yM=Object.create;var{getPrototypeOf:XM,defineProperty:o,getOwnPropertyNames:zM}=Object;var YM=Object.prototype.hasOwnProperty;var wM=(M,U,K)=>{K=M!=null?yM(XM(M)):{};let q=U||!M||!M.__esModule?o(K,"default",{value:M,enumerable:!0}):K;for(let Z of zM(M))if(!YM.call(q,Z))o(q,Z,{get:()=>M[Z],enumerable:!0});return q};var EM=(M,U)=>()=>(U||M((U={exports:{}}).exports,U),U.exports);var BM=EM((aM,jM)=>{var _,p,a,c,g,d,ZM,$M;function WM(M){if(M<0.5)M=0.5;var U=Math.exp(0.527076)/M,K=Math.exp(-U),q=Math.exp(-2*U),Z=(1-K)*(1-K)/(1+2*U*K-q);return _=Z,p=Z*(U-1)*K,a=Z*(U+1)*K,c=-Z*q,g=2*K,d=-q,ZM=(_+p)/(1-g-d),$M=(a+c)/(1-g-d),new Float32Array([_,p,a,c,g,d,ZM,$M])}function GM(M,U,K,q,Z,G){var J,Q,j,$,B,L,R,A,I,k,N,C,D,V,Y,w,y,z,H,F,W,X,S,E,v,u,P,T,O,b;for(v=0;v<G;v++){X=v*Z,S=v,E=0,J=M[X],Q=J&255,j=J>>8&255,$=J>>16&255,B=J>>24&255,z=Q*q[6],H=j*q[6],F=$*q[6],W=B*q[6],V=z,Y=H,w=F,y=W,P=q[0],T=q[1],O=q[4],b=q[5];for(u=0;u<Z;u++)J=M[X],L=J&255,R=J>>8&255,A=J>>16&255,I=J>>24&255,k=L*P+Q*T+V*O+z*b,N=R*P+j*T+Y*O+H*b,C=A*P+$*T+w*O+F*b,D=I*P+B*T+y*O+W*b,z=V,H=Y,F=w,W=y,V=k,Y=N,w=C,y=D,Q=L,j=R,$=A,B=I,K[E]=V,K[E+1]=Y,K[E+2]=w,K[E+3]=y,E+=4,X++;X--,E-=4,S+=G*(Z-1),J=M[X],Q=J&255,j=J>>8&255,$=J>>16&255,B=J>>24&255,z=Q*q[7],H=j*q[7],F=$*q[7],W=B*q[7],V=z,Y=H,w=F,y=W,L=Q,R=j,A=$,I=B,P=q[2],T=q[3];for(u=Z-1;u>=0;u--)k=L*P+Q*T+V*O+z*b,N=R*P+j*T+Y*O+H*b,C=A*P+$*T+w*O+F*b,D=I*P+B*T+y*O+W*b,z=V,H=Y,F=w,W=y,V=k,Y=N,w=C,y=D,Q=L,j=R,$=A,B=I,J=M[X],L=J&255,R=J>>8&255,A=J>>16&255,I=J>>24&255,J=(K[E]+V<<0)+(K[E+1]+Y<<8)+(K[E+2]+w<<16)+(K[E+3]+y<<24),U[S]=J,X--,E-=4,S-=G}}function PM(M,U,K,q){if(!q)return;var Z=new Uint32Array(M.buffer),G=new Uint32Array(Z.length),J=new Float32Array(Math.max(U,K)*4),Q=WM(q);GM(Z,G,J,Q,U,K,q),GM(G,Z,J,Q,K,U,q)}jM.exports=PM});function s(M,U,K,q,Z,G){let J=K/M,Q=q/U,j=(2*G+2+1)/Z;if(j>0.5)return[[K,q]];let $=Math.ceil(Math.log(Math.min(J,Q))/Math.log(j));if($<=1)return[[K,q]];let B=[];for(let L=0;L<$;L++){let R=Math.round(Math.pow(Math.pow(M,$-L-1)*Math.pow(K,L+1),1/$)),A=Math.round(Math.pow(Math.pow(U,$-L-1)*Math.pow(q,L+1),1/$));B.push([R,A])}return B}function r(M,U,K,q,Z){let G=new OffscreenCanvas(M.width,M.height),J=G.getContext("2d");if(!J)throw new Error("Pica: Canvas context is not supported");return J.globalCompositeOperation="copy",J.drawImage(q.srcImageBitmap||U,M.x,M.y,M.width,M.height,0,0,M.width,M.height),Z.src=J.getImageData(0,0,M.width,M.height).data,G.width=G.height=0,Z}var t=0.00001;function h(M){let U=Math.round(M);if(Math.abs(M-U)<t)return U;return Math.floor(M)}function i(M){let U=Math.round(M);if(Math.abs(M-U)<t)return U;return Math.ceil(M)}function e(M){let U=M.toWidth/M.width,K=M.toHeight/M.height,q=h(M.srcTileSize*U)-2*M.destTileBorder,Z=h(M.srcTileSize*K)-2*M.destTileBorder;if(q<1||Z<1)throw new Error("Internal error in pica: target tile width/height is too small.");let G,J,Q,j,$,B,L=[],R;for(j=0;j<M.toHeight;j+=Z)for(Q=0;Q<M.toWidth;Q+=q){if(G=Q-M.destTileBorder,G<0)G=0;if($=Q+q+M.destTileBorder-G,G+$>=M.toWidth)$=M.toWidth-G;if(J=j-M.destTileBorder,J<0)J=0;if(B=j+Z+M.destTileBorder-J,J+B>=M.toHeight)B=M.toHeight-J;R={toX:G,toY:J,toWidth:$,toHeight:B,toInnerX:Q,toInnerY:j,toInnerWidth:q,toInnerHeight:Z,offsetX:G/U-h(G/U),offsetY:J/K-h(J/K),scaleX:U,scaleY:K,x:h(G/U),y:h(J/K),width:i($/U),height:i(B/K)},L.push(R)}return L}var n={box:{win:0.5,fn:(M)=>{if(M<0)M=-M;return M<0.5?1:0}},hamming:{win:1,fn:(M)=>{if(M<0)M=-M;if(M>=1)return 0;if(M<0.00000011920929)return 1;let U=M*Math.PI;return Math.sin(U)/U*(0.54+0.46*Math.cos(U/1))}},lanczos2:{win:2,fn:(M)=>{if(M<0)M=-M;if(M>=2)return 0;if(M<0.00000011920929)return 1;let U=M*Math.PI;return Math.sin(U)/U*Math.sin(U/2)/(U/2)}},lanczos3:{win:3,fn:(M)=>{if(M<0)M=-M;if(M>=3)return 0;if(M<0.00000011920929)return 1;let U=M*Math.PI;return Math.sin(U)/U*Math.sin(U/3)/(U/3)}},mks2013:{win:2.5,fn:(M)=>{if(M<0)M=-M;if(M>=2.5)return 0;if(M>=1.5)return-0.125*(M-2.5)*(M-2.5);if(M>=0.5)return 0.25*(4*M*M-11*M+7);return 1.0625-1.75*M*M}}};var FM=14;function MM(M){return Math.round(M*((1<<FM)-1))}function f(M,U,K,q,Z){let G=n[M].fn,J=1/q,Q=Math.min(1,q),j=n[M].win/Q,$,B,L,R,A,I,k,N,C,D,V,Y,w,y,z,H,F,W=Math.floor((j+1)*2),X=new Int16Array((W+2)*K),S=0,E=!X.subarray||!X.set;for($=0;$<K;$++){B=($+0.5)*J+Z,L=Math.max(0,Math.floor(B-j)),R=Math.min(U-1,Math.ceil(B+j)),A=R-L+1,I=new Float32Array(A),k=new Int16Array(A),N=0;for(C=L,D=0;C<=R;C++,D++)V=G((C+0.5-B)*Q),N+=V,I[D]=V;Y=0;for(D=0;D<I.length;D++)w=I[D]/N,Y+=w,k[D]=MM(w);k[K>>1]+=MM(1-Y),y=0;while(y<k.length&&k[y]===0)y++;if(y<k.length){z=k.length-1;while(z>0&&k[z]===0)z--;if(H=L+y,F=z-y+1,X[S++]=H,X[S++]=F,!E)X.set(k.subarray(y,z+1),S),S+=F;else for(D=y;D<=z;D++)X[S++]=k[D]}else X[S++]=0,X[S++]=0}return X}function m(M){return M<0?0:M>255?255:M}function x(M){return M>=0?M:0}function UM(M,U,K,q,Z,G){let J,Q,j,$,B,L,R,A,I,k,N,C=0,D=0;for(I=0;I<q;I++){B=0;for(k=0;k<Z;k++){L=G[B++],R=G[B++],A=C+L*4|0,J=Q=j=$=0;for(;R>0;R--)N=G[B++],$=$+N*M[A+3]|0,j=j+N*M[A+2]|0,Q=Q+N*M[A+1]|0,J=J+N*M[A]|0,A=A+4|0;U[D+3]=x($>>7),U[D+2]=x(j>>7),U[D+1]=x(Q>>7),U[D]=x(J>>7),D=D+q*4|0}D=(I+1)*4|0,C=(I+1)*K*4|0}}function qM(M,U,K,q,Z,G){let J,Q,j,$,B,L,R,A,I,k,N,C=0,D=0;for(I=0;I<q;I++){B=0;for(k=0;k<Z;k++){L=G[B++],R=G[B++],A=C+L*4|0,J=Q=j=$=0;for(;R>0;R--)N=G[B++],$=$+N*M[A+3]|0,j=j+N*M[A+2]|0,Q=Q+N*M[A+1]|0,J=J+N*M[A]|0,A=A+4|0;J>>=7,Q>>=7,j>>=7,$>>=7,U[D+3]=m($+8192>>14),U[D+2]=m(j+8192>>14),U[D+1]=m(Q+8192>>14),U[D]=m(J+8192>>14),D=D+q*4|0}D=(I+1)*4|0,C=(I+1)*K*4|0}}function JM(M,U,K,q,Z,G){let J,Q,j,$,B,L,R,A,I,k,N,C,D=0,V=0;for(k=0;k<q;k++){L=0;for(N=0;N<Z;N++){R=G[L++],A=G[L++],I=D+R*4|0,J=Q=j=$=0;for(;A>0;A--)C=G[L++],B=M[I+3],$=$+C*B|0,j=j+C*M[I+2]*B|0,Q=Q+C*M[I+1]*B|0,J=J+C*M[I]*B|0,I=I+4|0;j=j/255|0,Q=Q/255|0,J=J/255|0,U[V+3]=x($>>7),U[V+2]=x(j>>7),U[V+1]=x(Q>>7),U[V]=x(J>>7),V=V+q*4|0}V=(k+1)*4|0,D=(k+1)*K*4|0}}function KM(M,U,K,q,Z,G){let J,Q,j,$,B,L,R,A,I,k,N,C=0,D=0;for(I=0;I<q;I++){B=0;for(k=0;k<Z;k++){L=G[B++],R=G[B++],A=C+L*4|0,J=Q=j=$=0;for(;R>0;R--)N=G[B++],$=$+N*M[A+3]|0,j=j+N*M[A+2]|0,Q=Q+N*M[A+1]|0,J=J+N*M[A]|0,A=A+4|0;if(J>>=7,Q>>=7,j>>=7,$>>=7,$=m($+8192>>14),$>0)J=J*255/$|0,Q=Q*255/$|0,j=j*255/$|0;U[D+3]=$,U[D+2]=m(j+8192>>14),U[D+1]=m(Q+8192>>14),U[D]=m(J+8192>>14),D=D+q*4|0}D=(I+1)*4|0,C=(I+1)*K*4|0}}function SM(M,U,K){let q=3,Z=U*K*4|0;while(q<Z){if(M[q]!==255)return!0;q=q+4|0}return!1}function HM(M,U,K){let q=3,Z=U*K*4|0;while(q<Z)M[q]=255,q=q+4|0}function QM(M){let{src:U,width:K,height:q,toWidth:Z,toHeight:G}=M,J=M.scaleX||M.toWidth/M.width,Q=M.scaleY||M.toHeight/M.height,j=M.offsetX||0,$=M.offsetY||0,B=M.dest||new Uint8Array(Z*G*4),L=typeof M.filter==="undefined"?"mks2013":M.filter,R=f(L,K,Z,J,j),A=f(L,q,G,Q,$),I=new Uint16Array(Z*q*4);if(SM(U,K,q))JM(U,I,K,q,Z,R),KM(I,B,q,Z,G,A);else UM(U,I,K,q,Z,R),qM(I,B,q,Z,G,A),HM(B,Z,G);return B}var AM=wM(BM(),1);function TM(M,U,K){let q=U*K,Z=new Uint16Array(q),G,J,Q,j;for(let $=0;$<q;$++)G=M[4*$],J=M[4*$+1],Q=M[4*$+2],j=G>=J&&G>=Q?G:J>=Q&&J>=G?J:Q,Z[$]=j<<8;return Z}function IM(M,U,K,q,Z,G){let J,Q,j,$,B;if(q===0||Z<0.5)return;if(Z>2)Z=2;let L=TM(M,U,K),R=new Uint16Array(L);AM.default(R,U,K,Z);let A=q/100*4096+0.5|0,I=G<<8,k=U*K;for(let N=0;N<k;N++)if(J=L[N],$=J-R[N],Math.abs($)>=I)Q=J+(A*$+2048>>12),Q=Q>65280?65280:Q,Q=Q<0?0:Q,J=J!==0?J:1,j=(Q<<12)/J|0,B=N*4,M[B]=M[B]*j+2048>>12,M[B+1]=M[B+1]*j+2048>>12,M[B+2]=M[B+2]*j+2048>>12}function DM(M){let U=QM(M);if(M.unsharpAmount)IM(U,M.toWidth,M.toHeight,M.unsharpAmount,M.unsharpRadius,M.unsharpThreshold);return U}function LM(M){return Promise.resolve().then(()=>{return{data:DM(M)}})}function RM(M,U,K){let q;if(q=new ImageData(new Uint8ClampedArray(U.data),M.toWidth,M.toHeight),!1)K.toCtx?.putImageData(q,M.toX,M.toY,M.toInnerX-M.toX,M.toInnerY-M.toY,M.toInnerWidth+0.00001,M.toInnerHeight+0.00001);else K.toCtx?.putImageData(q,M.toX,M.toY,M.toInnerX-M.toX,M.toInnerY-M.toY,M.toInnerWidth,M.toInnerHeight);return null}function kM(M){return M instanceof OffscreenCanvas}function NM(M){return M instanceof ImageBitmap}var bM=(M,U,K,q)=>{let Z={width:M.width,height:M.height,toWidth:M.toWidth,toHeight:M.toHeight,scaleX:M.scaleX,scaleY:M.scaleY,offsetX:M.offsetX,offsetY:M.offsetY,filter:K.filter,unsharpAmount:K.unsharpAmount,unsharpRadius:K.unsharpRadius,unsharpThreshold:K.unsharpThreshold};return Promise.resolve(Z).then((G)=>r(M,U,null,q,G)).then((G)=>LM(G)).then((G)=>RM(M,G,q))};function CM(M,U,K){let q={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(()=>{if(q.toCtx=U.getContext("2d"),kM(M))return null;if(NM(M))return q.srcImageBitmap=M,q.isImageBitmapReused=!0,null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(()=>{let G=e({width:K.width,height:K.height,srcTileSize:1024,toWidth:K.toWidth,toHeight:K.toHeight,destTileBorder:K.destTileBorder}).map((Q)=>bM(Q,M,K,q));function J(Q){if(Q.srcImageBitmap){if(!Q.isImageBitmapReused)Q.srcImageBitmap.close();Q.srcImageBitmap=null}}return Promise.all(G).then(()=>{return J(q),U},(Q)=>{throw J(q),Q})})}async function l(M,U,K,q){let[Z,G]=M.shift(),J=M.length===0;q.toWidth=Z,q.toHeight=G;let Q;if(!J)Q=new OffscreenCanvas(Z,G);if(await CM(U,J?K:Q,q),J)return K;q.width=Z,q.height=G;let j=await l(M,U,Q,q);if(Q)Q.width=Q.height=0;return j}async function VM(M,U){let K=U.maxDimension,q=U.tileSize??1024,Z=U.unsharpAmount??0,G=U.unsharpRadius??0,J=U.unsharpThreshold??0,Q=await createImageBitmap(M),j=Q.width,$=Q.height,B=K/j,L=K/$,R=Math.min(B,L,1),A=Math.floor(j*R),I=Math.floor($*R),k=new OffscreenCanvas(A,I),N=3,C=Math.ceil(Math.max(3,2.5*G|0)),D=s(j,$,A,I,q,C);return(await l(D,Q,k,{filter:"mks2013",unsharpAmount:Z,unsharpRadius:G,unsharpThreshold:J,width:j,height:$,toWidth:A,toHeight:I,destTileBorder:C})).transferToImageBitmap()}self.onmessage=async(M)=>{let{taskId:U,blob:K,options:q}=M.data;try{let Z=await VM(K,q);self.postMessage({taskId:U,output:Z},[Z])}catch(Z){self.postMessage({taskId:U,error:Z})}};
`,xk=new Blob([hk],{type:"application/javascript"}),vk=(()=>{let k=0;return()=>++k})();class zk{#M;#I;#Q;#k;constructor(){this.#M=new Map,this.#I=new Map,this.#Q=new Map,this.#k=new Map}get count(){return this.#M.size}setWorkerTimeout(k,M){let U=setTimeout(()=>{let I=this.#M.get(k);if(I)this.#Q.delete(I);if(I)this.#k.delete(I);this.#I.delete(k),this.#M.delete(k),k.terminate()},M);this.#I.set(k,U)}clearWorkerTimeout(k){clearTimeout(this.#I.get(k))}addWorker(k){this.#M.set(k,null)}getWorker(k){return this.#Q.get(k)}getTask(k){return this.#k.get(k)}getAvailableWorker(){for(let[k,M]of this.#M.entries())if(M===null)return k;return null}assignTask(k,M){this.#M.set(k,M.id),this.#Q.set(M.id,k),this.#k.set(M.id,M);let U={taskId:M.id,blob:M.data.blob,options:M.data.options};k.postMessage(U)}removeTask(k){let M=this.#Q.get(k);if(M)this.#M.set(M,null);this.#Q.delete(k),this.#k.delete(k)}}class l{#M;#I;#Q;#k;constructor(k,M){this.#I=k,this.#M=M,this.#Q=[],this.#k=new zk}#q(){let k=new Worker(URL.createObjectURL(xk));k.onmessage=(M)=>{let{taskId:U,output:I,error:Z}=M.data,K=this.#k.getWorker(U),Q=this.#k.getTask(U);if(Z){if(Q)Q.reject(Z)}else if(Q)Q.resolve(I);if(this.#k.removeTask(U),K)this.#k.setWorkerTimeout(K,this.#M);this.#U()},k.onerror=(M)=>{console.log(M.message),console.log(M)},this.#k.addWorker(k)}#U(){let k=this.#k.getAvailableWorker();if(k){let M=this.#Q.shift();if(M)this.#k.assignTask(k,M),this.#k.clearWorkerTimeout(k)}else if(this.#k.count<this.#I)this.#q(),this.#U()}addTask(k){return new Promise((M,U)=>{this.#Q.push({id:vk(),data:{blob:k.blob,options:k.options},resolve:M,reject:U}),this.#U()})}}class nk{#M;#I;constructor(k){let M=typeof navigator==="undefined"?1:navigator.hardwareConcurrency,U=k.maxWorkerPoolSize||Math.min(M,4),I=k.maxWorkerIdleTime||2000;this.#M=new l(U,I),this.#I=k}squish(k,M){let U=M?{...this.#I,...M}:this.#I;if(U.useMainThread)return Vk(k,U);return this.#M.addTask({blob:k,options:U})}}export{nk as PicSquish};
