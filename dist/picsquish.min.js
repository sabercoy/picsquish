var wk=Object.create;var{getPrototypeOf:Ok,defineProperty:l,getOwnPropertyNames:Ek}=Object;var mk=Object.prototype.hasOwnProperty;var Vk=(k,M,U)=>{U=k!=null?wk(Ok(k)):{};let C=M||!k||!k.__esModule?l(U,"default",{value:k,enumerable:!0}):U;for(let J of Ek(k))if(!mk.call(C,J))l(C,J,{get:()=>k[J],enumerable:!0});return C};var Nk=(k,M)=>()=>(M||k((M={exports:{}}).exports,M),M.exports);var nk=Nk((_k,$k)=>{var d,a,s,f,h,p,Kk,Rk;function Dk(k){if(k<0.5)k=0.5;var M=Math.exp(0.527076)/k,U=Math.exp(-M),C=Math.exp(-2*M),J=(1-U)*(1-U)/(1+2*M*U-C);return d=J,a=J*(M-1)*U,s=J*(M+1)*U,f=-J*C,h=2*U,p=-C,Kk=(d+a)/(1-h-p),Rk=(s+f)/(1-h-p),new Float32Array([d,a,s,f,h,p,Kk,Rk])}function Jk(k,M,U,C,J,$){var Q,I,R,q,K,Z,A,n,j,L,B,y,G,w,V,N,O,m,Y,T,D,E,X,z,v,u,W,F,S,P;for(v=0;v<$;v++){E=v*J,X=v,z=0,Q=k[E],I=Q&255,R=Q>>8&255,q=Q>>16&255,K=Q>>24&255,m=I*C[6],Y=R*C[6],T=q*C[6],D=K*C[6],w=m,V=Y,N=T,O=D,W=C[0],F=C[1],S=C[4],P=C[5];for(u=0;u<J;u++)Q=k[E],Z=Q&255,A=Q>>8&255,n=Q>>16&255,j=Q>>24&255,L=Z*W+I*F+w*S+m*P,B=A*W+R*F+V*S+Y*P,y=n*W+q*F+N*S+T*P,G=j*W+K*F+O*S+D*P,m=w,Y=V,T=N,D=O,w=L,V=B,N=y,O=G,I=Z,R=A,q=n,K=j,U[z]=w,U[z+1]=V,U[z+2]=N,U[z+3]=O,z+=4,E++;E--,z-=4,X+=$*(J-1),Q=k[E],I=Q&255,R=Q>>8&255,q=Q>>16&255,K=Q>>24&255,m=I*C[7],Y=R*C[7],T=q*C[7],D=K*C[7],w=m,V=Y,N=T,O=D,Z=I,A=R,n=q,j=K,W=C[2],F=C[3];for(u=J-1;u>=0;u--)L=Z*W+I*F+w*S+m*P,B=A*W+R*F+V*S+Y*P,y=n*W+q*F+N*S+T*P,G=j*W+K*F+O*S+D*P,m=w,Y=V,T=N,D=O,w=L,V=B,N=y,O=G,I=Z,R=A,q=n,K=j,Q=k[E],Z=Q&255,A=Q>>8&255,n=Q>>16&255,j=Q>>24&255,Q=(U[z]+w<<0)+(U[z+1]+V<<8)+(U[z+2]+N<<16)+(U[z+3]+O<<24),M[X]=Q,E--,z-=4,X-=$}}function Wk(k,M,U,C){if(!C)return;var J=new Uint32Array(k.buffer),$=new Uint32Array(J.length),Q=new Float32Array(Math.max(M,U)*4),I=Dk(C);Jk(J,$,Q,I,M,U,C),Jk($,J,Q,I,U,M,C)}$k.exports=Wk});var zk=2;function _(k,M,U,C,J,$){let Q=U/k,I=C/M,R=(2*$+zk+1)/J;if(R>0.5)return[{toWidth:U,toHeight:C}];let q=Math.ceil(Math.log(Math.min(Q,I))/Math.log(R));if(q<=1)return[{toWidth:U,toHeight:C}];let K=[];for(let Z=0;Z<q;Z++){let A=Math.round(Math.pow(Math.pow(k,q-Z-1)*Math.pow(U,Z+1),1/q)),n=Math.round(Math.pow(Math.pow(M,q-Z-1)*Math.pow(C,Z+1),1/q));K.push({toWidth:A,toHeight:n})}return K}function i(k,M){let C=new OffscreenCanvas(k.width,k.height).getContext("2d");if(!C)throw new Error("Pica: Canvas context is not supported");return C.globalCompositeOperation="copy",C.drawImage(M,k.x,k.y,k.width,k.height,0,0,k.width,k.height),C.getImageData(0,0,k.width,k.height).data}var t=0.00001;function x(k){let M=Math.round(k);if(Math.abs(k-M)<t)return M;return Math.floor(k)}function r(k){let M=Math.round(k);if(Math.abs(k-M)<t)return M;return Math.ceil(k)}function e(k,M,U,C,J,$){let Q=C/k,I=J/M,R=x(U*Q)-2*$,q=x(U*I)-2*$;if(R<1||q<1)throw new Error("Internal error in pica: target tile width/height is too small.");let K,Z,A,n,j,L,B=[];for(n=0;n<J;n+=q)for(A=0;A<C;A+=R){if(K=A-$,K<0)K=0;if(j=A+R+$-K,K+j>=C)j=C-K;if(Z=n-$,Z<0)Z=0;if(L=n+q+$-Z,Z+L>=J)L=J-Z;B.push({toX:K,toY:Z,toWidth:j,toHeight:L,toInnerX:A,toInnerY:n,toInnerWidth:R,toInnerHeight:q,offsetX:K/Q-x(K/Q),offsetY:Z/I-x(Z/I),scaleX:Q,scaleY:I,x:x(K/Q),y:x(Z/I),width:r(j/Q),height:r(L/I)})}return B}function kk(k,M,U){let C=new ImageData(new Uint8ClampedArray(M),k.toWidth,k.toHeight),J=!1;U.putImageData(C,k.toX,k.toY,k.toInnerX-k.toX,k.toInnerY-k.toY,k.toInnerWidth,k.toInnerHeight)}var g={box:{win:0.5,fn:(k)=>{if(k<0)k=-k;return k<0.5?1:0}},hamming:{win:1,fn:(k)=>{if(k<0)k=-k;if(k>=1)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*(0.54+0.46*Math.cos(M/1))}},lanczos2:{win:2,fn:(k)=>{if(k<0)k=-k;if(k>=2)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*Math.sin(M/2)/(M/2)}},lanczos3:{win:3,fn:(k)=>{if(k<0)k=-k;if(k>=3)return 0;if(k<0.00000011920929)return 1;let M=k*Math.PI;return Math.sin(M)/M*Math.sin(M/3)/(M/3)}},mks2013:{win:2.5,fn:(k)=>{if(k<0)k=-k;if(k>=2.5)return 0;if(k>=1.5)return-0.125*(k-2.5)*(k-2.5);if(k>=0.5)return 0.25*(4*k*k-11*k+7);return 1.0625-1.75*k*k}}};var Tk=14;function Mk(k){return Math.round(k*((1<<Tk)-1))}function o(k,M,U,C,J){let $=g[k].fn,Q=1/C,I=Math.min(1,C),R=g[k].win/I,q,K,Z,A,n,j,L,B,y,G,w,V,N,O,m,Y,T,D=Math.floor((R+1)*2),E=new Int16Array((D+2)*U),X=0,z=!E.subarray||!E.set;for(q=0;q<U;q++){K=(q+0.5)*Q+J,Z=Math.max(0,Math.floor(K-R)),A=Math.min(M-1,Math.ceil(K+R)),n=A-Z+1,j=new Float32Array(n),L=new Int16Array(n),B=0;for(y=Z,G=0;y<=A;y++,G++)w=$((y+0.5-K)*I),B+=w,j[G]=w;V=0;for(G=0;G<j.length;G++)N=j[G]/B,V+=N,L[G]=Mk(N);L[U>>1]+=Mk(1-V),O=0;while(O<L.length&&L[O]===0)O++;if(O<L.length){m=L.length-1;while(m>0&&L[m]===0)m--;if(Y=Z+O,T=m-O+1,E[X++]=Y,E[X++]=T,!z)E.set(L.subarray(O,m+1),X),X+=T;else for(G=O;G<=m;G++)E[X++]=L[G]}else E[X++]=0,E[X++]=0}return E}function b(k){return k<0?0:k>255?255:k}function H(k){return k>=0?k:0}function Ck(k,M,U,C,J,$){let Q,I,R,q,K,Z,A,n,j,L,B,y=0,G=0;for(j=0;j<C;j++){K=0;for(L=0;L<J;L++){Z=$[K++],A=$[K++],n=y+Z*4|0,Q=I=R=q=0;for(;A>0;A--)B=$[K++],q=q+B*k[n+3]|0,R=R+B*k[n+2]|0,I=I+B*k[n+1]|0,Q=Q+B*k[n]|0,n=n+4|0;M[G+3]=H(q>>7),M[G+2]=H(R>>7),M[G+1]=H(I>>7),M[G]=H(Q>>7),G=G+C*4|0}G=(j+1)*4|0,y=(j+1)*U*4|0}}function Qk(k,M,U,C,J,$){let Q,I,R,q,K,Z,A,n,j,L,B,y=0,G=0;for(j=0;j<C;j++){K=0;for(L=0;L<J;L++){Z=$[K++],A=$[K++],n=y+Z*4|0,Q=I=R=q=0;for(;A>0;A--)B=$[K++],q=q+B*k[n+3]|0,R=R+B*k[n+2]|0,I=I+B*k[n+1]|0,Q=Q+B*k[n]|0,n=n+4|0;Q>>=7,I>>=7,R>>=7,q>>=7,M[G+3]=b(q+8192>>14),M[G+2]=b(R+8192>>14),M[G+1]=b(I+8192>>14),M[G]=b(Q+8192>>14),G=G+C*4|0}G=(j+1)*4|0,y=(j+1)*U*4|0}}function Uk(k,M,U,C,J,$){let Q,I,R,q,K,Z,A,n,j,L,B,y,G=0,w=0;for(L=0;L<C;L++){Z=0;for(B=0;B<J;B++){A=$[Z++],n=$[Z++],j=G+A*4|0,Q=I=R=q=0;for(;n>0;n--)y=$[Z++],K=k[j+3],q=q+y*K|0,R=R+y*k[j+2]*K|0,I=I+y*k[j+1]*K|0,Q=Q+y*k[j]*K|0,j=j+4|0;R=R/255|0,I=I/255|0,Q=Q/255|0,M[w+3]=H(q>>7),M[w+2]=H(R>>7),M[w+1]=H(I>>7),M[w]=H(Q>>7),w=w+C*4|0}w=(L+1)*4|0,G=(L+1)*U*4|0}}function qk(k,M,U,C,J,$){let Q,I,R,q,K,Z,A,n,j,L,B,y=0,G=0;for(j=0;j<C;j++){K=0;for(L=0;L<J;L++){Z=$[K++],A=$[K++],n=y+Z*4|0,Q=I=R=q=0;for(;A>0;A--)B=$[K++],q=q+B*k[n+3]|0,R=R+B*k[n+2]|0,I=I+B*k[n+1]|0,Q=Q+B*k[n]|0,n=n+4|0;if(Q>>=7,I>>=7,R>>=7,q>>=7,q=b(q+8192>>14),q>0)Q=Q*255/q|0,I=I*255/q|0,R=R*255/q|0;M[G+3]=q,M[G+2]=b(R+8192>>14),M[G+1]=b(I+8192>>14),M[G]=b(Q+8192>>14),G=G+C*4|0}G=(j+1)*4|0,y=(j+1)*U*4|0}}function Xk(k,M,U){let C=3,J=M*U*4|0;while(C<J){if(k[C]!==255)return!0;C=C+4|0}return!1}function Yk(k,M,U){let C=3,J=M*U*4|0;while(C<J)k[C]=255,C=C+4|0}function Ik(k,M,U,C,J,$,Q,I,R,q){let K=o(k,U,J,Q,R),Z=o(k,C,$,I,q),A=new Uint8Array(J*$*4),n=new Uint16Array(J*C*4);if(Xk(M,U,C))Uk(M,n,U,C,J,K),qk(n,A,C,J,$,Z);else Ck(M,n,U,C,J,K),Qk(n,A,C,J,$,Z),Yk(A,J,$);return A}var Zk=Vk(nk(),1);function Fk(k,M,U){let C=M*U,J=new Uint16Array(C),$,Q,I,R;for(let q=0;q<C;q++)$=k[4*q],Q=k[4*q+1],I=k[4*q+2],R=$>=Q&&$>=I?$:Q>=I&&Q>=$?Q:I,J[q]=R<<8;return J}function jk(k,M,U,C,J,$){let Q,I,R,q,K;if(C===0||J<0.5)return;if(J>2)J=2;let Z=Fk(k,M,U),A=new Uint16Array(Z);Zk.default(A,M,U,J);let n=C/100*4096+0.5|0,j=$<<8,L=M*U;for(let B=0;B<L;B++)if(Q=Z[B],q=Q-A[B],Math.abs(q)>=j)I=Q+(n*q+2048>>12),I=I>65280?65280:I,I=I<0?0:I,Q=Q!==0?Q:1,R=(I<<12)/Q|0,K=B*4,k[K]=k[K]*R+2048>>12,k[K+1]=k[K+1]*R+2048>>12,k[K+2]=k[K+2]*R+2048>>12}function Ak(k,M,U,C,J,$,Q,I,R,q,K,Z,A){let n=Ik(k,M,U,C,J,$,Q,I,R,q);if(K)jk(n,J,$,K,Z,A);return n}var Sk=(k,M,U,C,J,$,Q)=>{let I=i(k,M),R=Ak(U,I,k.width,k.height,k.toWidth,k.toHeight,k.scaleX,k.scaleY,k.offsetX,k.offsetY,C,J,$);kk(k,R,Q)};async function Gk(k,M,U,C,J,$,Q,I){let R=M.getContext("2d");if(!R)throw new Error("Pica: Canvas context is not supported");let q=e(k.width,k.height,U,M.width,M.height,C);for(let K of q)Sk(K,k,J,$,Q,I,R)}async function Lk(k,M,U,C,J,$,Q,I){let R=M,q=new OffscreenCanvas(k[0].toWidth,k[0].toHeight);for(let K=0;K<k.length;K++){await Gk(R,q,U,C,J,$,Q,I);let Z=k[K+1];if(!Z)break;R=q,q=new OffscreenCanvas(Z.toWidth,Z.toHeight)}return q}async function Bk(k,M){let U=M.maxDimension,C=M.tileSize||1024,J=M.filter||"mks2013",$=M.unsharpAmount||0,Q=M.unsharpRadius||0,I=M.unsharpThreshold||0,R=await createImageBitmap(k),q=R.width,K=R.height,Z=U/q,A=U/K,n=Math.min(Z,A,1),j=Math.floor(q*n),L=Math.floor(K*n),B=3,y=Math.ceil(Math.max(3,2.5*Q|0)),G=_(q,K,j,L,C,y);return(await Lk(G,R,C,y,J,$,Q,I)).transferToImageBitmap()}var Pk=`
var y0=Object.create;var{getPrototypeOf:E0,defineProperty:_,getOwnPropertyNames:V0}=Object;var N0=Object.prototype.hasOwnProperty;var w0=(C,M,Q)=>{Q=C!=null?y0(E0(C)):{};let U=M||!C||!C.__esModule?_(Q,"default",{value:C,enumerable:!0}):Q;for(let Z of V0(C))if(!N0.call(U,Z))_(U,Z,{get:()=>C[Z],enumerable:!0});return U};var O0=(C,M)=>()=>(M||C((M={exports:{}}).exports,M),M.exports);var A0=O0((f0,G0)=>{var f,a,o,c,h,g,Q0,$0;function F0(C){if(C<0.5)C=0.5;var M=Math.exp(0.527076)/C,Q=Math.exp(-M),U=Math.exp(-2*M),Z=(1-Q)*(1-Q)/(1+2*M*Q-U);return f=Z,a=Z*(M-1)*Q,o=Z*(M+1)*Q,c=-Z*U,h=2*Q,g=-U,Q0=(f+a)/(1-h-g),$0=(o+c)/(1-h-g),new Float32Array([f,a,o,c,h,g,Q0,$0])}function Z0(C,M,Q,U,Z,j){var q,K,G,J,$,R,I,A,L,B,y,E,k,V,z,X,N,O,S,D,m,w,F,Y,v,u,P,H,W,T;for(v=0;v<j;v++){w=v*Z,F=v,Y=0,q=C[w],K=q&255,G=q>>8&255,J=q>>16&255,$=q>>24&255,O=K*U[6],S=G*U[6],D=J*U[6],m=$*U[6],V=O,z=S,X=D,N=m,P=U[0],H=U[1],W=U[4],T=U[5];for(u=0;u<Z;u++)q=C[w],R=q&255,I=q>>8&255,A=q>>16&255,L=q>>24&255,B=R*P+K*H+V*W+O*T,y=I*P+G*H+z*W+S*T,E=A*P+J*H+X*W+D*T,k=L*P+$*H+N*W+m*T,O=V,S=z,D=X,m=N,V=B,z=y,X=E,N=k,K=R,G=I,J=A,$=L,Q[Y]=V,Q[Y+1]=z,Q[Y+2]=X,Q[Y+3]=N,Y+=4,w++;w--,Y-=4,F+=j*(Z-1),q=C[w],K=q&255,G=q>>8&255,J=q>>16&255,$=q>>24&255,O=K*U[7],S=G*U[7],D=J*U[7],m=$*U[7],V=O,z=S,X=D,N=m,R=K,I=G,A=J,L=$,P=U[2],H=U[3];for(u=Z-1;u>=0;u--)B=R*P+K*H+V*W+O*T,y=I*P+G*H+z*W+S*T,E=A*P+J*H+X*W+D*T,k=L*P+$*H+N*W+m*T,O=V,S=z,D=X,m=N,V=B,z=y,X=E,N=k,K=R,G=I,J=A,$=L,q=C[w],R=q&255,I=q>>8&255,A=q>>16&255,L=q>>24&255,q=(Q[Y]+V<<0)+(Q[Y+1]+z<<8)+(Q[Y+2]+X<<16)+(Q[Y+3]+N<<24),M[F]=q,w--,Y-=4,F-=j}}function S0(C,M,Q,U){if(!U)return;var Z=new Uint32Array(C.buffer),j=new Uint32Array(Z.length),q=new Float32Array(Math.max(M,Q)*4),K=F0(U);Z0(Z,j,q,K,M,Q,U),Z0(j,Z,q,K,Q,M,U)}G0.exports=S0});var z0=2;function l(C,M,Q,U,Z,j){let q=Q/C,K=U/M,G=(2*j+z0+1)/Z;if(G>0.5)return[{toWidth:Q,toHeight:U}];let J=Math.ceil(Math.log(Math.min(q,K))/Math.log(G));if(J<=1)return[{toWidth:Q,toHeight:U}];let $=[];for(let R=0;R<J;R++){let I=Math.round(Math.pow(Math.pow(C,J-R-1)*Math.pow(Q,R+1),1/J)),A=Math.round(Math.pow(Math.pow(M,J-R-1)*Math.pow(U,R+1),1/J));$.push({toWidth:I,toHeight:A})}return $}function s(C,M){let U=new OffscreenCanvas(C.width,C.height).getContext("2d");if(!U)throw new Error("Pica: Canvas context is not supported");return U.globalCompositeOperation="copy",U.drawImage(M,C.x,C.y,C.width,C.height,0,0,C.width,C.height),U.getImageData(0,0,C.width,C.height).data}var r=0.00001;function x(C){let M=Math.round(C);if(Math.abs(C-M)<r)return M;return Math.floor(C)}function i(C){let M=Math.round(C);if(Math.abs(C-M)<r)return M;return Math.ceil(C)}function t(C,M,Q,U,Z,j){let q=U/C,K=Z/M,G=x(Q*q)-2*j,J=x(Q*K)-2*j;if(G<1||J<1)throw new Error("Internal error in pica: target tile width/height is too small.");let $,R,I,A,L,B,y=[];for(A=0;A<Z;A+=J)for(I=0;I<U;I+=G){if($=I-j,$<0)$=0;if(L=I+G+j-$,$+L>=U)L=U-$;if(R=A-j,R<0)R=0;if(B=A+J+j-R,R+B>=Z)B=Z-R;y.push({toX:$,toY:R,toWidth:L,toHeight:B,toInnerX:I,toInnerY:A,toInnerWidth:G,toInnerHeight:J,offsetX:$/q-x($/q),offsetY:R/K-x(R/K),scaleX:q,scaleY:K,x:x($/q),y:x(R/K),width:i(L/q),height:i(B/K)})}return y}function e(C,M,Q){let U=new ImageData(new Uint8ClampedArray(M),C.toWidth,C.toHeight),Z=!1;Q.putImageData(U,C.toX,C.toY,C.toInnerX-C.toX,C.toInnerY-C.toY,C.toInnerWidth,C.toInnerHeight)}var p={box:{win:0.5,fn:(C)=>{if(C<0)C=-C;return C<0.5?1:0}},hamming:{win:1,fn:(C)=>{if(C<0)C=-C;if(C>=1)return 0;if(C<0.00000011920929)return 1;let M=C*Math.PI;return Math.sin(M)/M*(0.54+0.46*Math.cos(M/1))}},lanczos2:{win:2,fn:(C)=>{if(C<0)C=-C;if(C>=2)return 0;if(C<0.00000011920929)return 1;let M=C*Math.PI;return Math.sin(M)/M*Math.sin(M/2)/(M/2)}},lanczos3:{win:3,fn:(C)=>{if(C<0)C=-C;if(C>=3)return 0;if(C<0.00000011920929)return 1;let M=C*Math.PI;return Math.sin(M)/M*Math.sin(M/3)/(M/3)}},mks2013:{win:2.5,fn:(C)=>{if(C<0)C=-C;if(C>=2.5)return 0;if(C>=1.5)return-0.125*(C-2.5)*(C-2.5);if(C>=0.5)return 0.25*(4*C*C-11*C+7);return 1.0625-1.75*C*C}}};var X0=14;function C0(C){return Math.round(C*((1<<X0)-1))}function d(C,M,Q,U,Z){let j=p[C].fn,q=1/U,K=Math.min(1,U),G=p[C].win/K,J,$,R,I,A,L,B,y,E,k,V,z,X,N,O,S,D,m=Math.floor((G+1)*2),w=new Int16Array((m+2)*Q),F=0,Y=!w.subarray||!w.set;for(J=0;J<Q;J++){$=(J+0.5)*q+Z,R=Math.max(0,Math.floor($-G)),I=Math.min(M-1,Math.ceil($+G)),A=I-R+1,L=new Float32Array(A),B=new Int16Array(A),y=0;for(E=R,k=0;E<=I;E++,k++)V=j((E+0.5-$)*K),y+=V,L[k]=V;z=0;for(k=0;k<L.length;k++)X=L[k]/y,z+=X,B[k]=C0(X);B[Q>>1]+=C0(1-z),N=0;while(N<B.length&&B[N]===0)N++;if(N<B.length){O=B.length-1;while(O>0&&B[O]===0)O--;if(S=R+N,D=O-N+1,w[F++]=S,w[F++]=D,!Y)w.set(B.subarray(N,O+1),F),F+=D;else for(k=N;k<=O;k++)w[F++]=B[k]}else w[F++]=0,w[F++]=0}return w}function n(C){return C<0?0:C>255?255:C}function b(C){return C>=0?C:0}function M0(C,M,Q,U,Z,j){let q,K,G,J,$,R,I,A,L,B,y,E=0,k=0;for(L=0;L<U;L++){$=0;for(B=0;B<Z;B++){R=j[$++],I=j[$++],A=E+R*4|0,q=K=G=J=0;for(;I>0;I--)y=j[$++],J=J+y*C[A+3]|0,G=G+y*C[A+2]|0,K=K+y*C[A+1]|0,q=q+y*C[A]|0,A=A+4|0;M[k+3]=b(J>>7),M[k+2]=b(G>>7),M[k+1]=b(K>>7),M[k]=b(q>>7),k=k+U*4|0}k=(L+1)*4|0,E=(L+1)*Q*4|0}}function U0(C,M,Q,U,Z,j){let q,K,G,J,$,R,I,A,L,B,y,E=0,k=0;for(L=0;L<U;L++){$=0;for(B=0;B<Z;B++){R=j[$++],I=j[$++],A=E+R*4|0,q=K=G=J=0;for(;I>0;I--)y=j[$++],J=J+y*C[A+3]|0,G=G+y*C[A+2]|0,K=K+y*C[A+1]|0,q=q+y*C[A]|0,A=A+4|0;q>>=7,K>>=7,G>>=7,J>>=7,M[k+3]=n(J+8192>>14),M[k+2]=n(G+8192>>14),M[k+1]=n(K+8192>>14),M[k]=n(q+8192>>14),k=k+U*4|0}k=(L+1)*4|0,E=(L+1)*Q*4|0}}function q0(C,M,Q,U,Z,j){let q,K,G,J,$,R,I,A,L,B,y,E,k=0,V=0;for(B=0;B<U;B++){R=0;for(y=0;y<Z;y++){I=j[R++],A=j[R++],L=k+I*4|0,q=K=G=J=0;for(;A>0;A--)E=j[R++],$=C[L+3],J=J+E*$|0,G=G+E*C[L+2]*$|0,K=K+E*C[L+1]*$|0,q=q+E*C[L]*$|0,L=L+4|0;G=G/255|0,K=K/255|0,q=q/255|0,M[V+3]=b(J>>7),M[V+2]=b(G>>7),M[V+1]=b(K>>7),M[V]=b(q>>7),V=V+U*4|0}V=(B+1)*4|0,k=(B+1)*Q*4|0}}function J0(C,M,Q,U,Z,j){let q,K,G,J,$,R,I,A,L,B,y,E=0,k=0;for(L=0;L<U;L++){$=0;for(B=0;B<Z;B++){R=j[$++],I=j[$++],A=E+R*4|0,q=K=G=J=0;for(;I>0;I--)y=j[$++],J=J+y*C[A+3]|0,G=G+y*C[A+2]|0,K=K+y*C[A+1]|0,q=q+y*C[A]|0,A=A+4|0;if(q>>=7,K>>=7,G>>=7,J>>=7,J=n(J+8192>>14),J>0)q=q*255/J|0,K=K*255/J|0,G=G*255/J|0;M[k+3]=J,M[k+2]=n(G+8192>>14),M[k+1]=n(K+8192>>14),M[k]=n(q+8192>>14),k=k+U*4|0}k=(L+1)*4|0,E=(L+1)*Q*4|0}}function Y0(C,M,Q){let U=3,Z=M*Q*4|0;while(U<Z){if(C[U]!==255)return!0;U=U+4|0}return!1}function D0(C,M,Q){let U=3,Z=M*Q*4|0;while(U<Z)C[U]=255,U=U+4|0}function K0(C,M,Q,U,Z,j,q,K,G,J){let $=d(C,Q,Z,q,G),R=d(C,U,j,K,J),I=new Uint8Array(Z*j*4),A=new Uint16Array(Z*U*4);if(Y0(M,Q,U))q0(M,A,Q,U,Z,$),J0(A,I,U,Z,j,R);else M0(M,A,Q,U,Z,$),U0(A,I,U,Z,j,R),D0(I,Z,j);return I}var j0=w0(A0(),1);function m0(C,M,Q){let U=M*Q,Z=new Uint16Array(U),j,q,K,G;for(let J=0;J<U;J++)j=C[4*J],q=C[4*J+1],K=C[4*J+2],G=j>=q&&j>=K?j:q>=K&&q>=j?q:K,Z[J]=G<<8;return Z}function R0(C,M,Q,U,Z,j){let q,K,G,J,$;if(U===0||Z<0.5)return;if(Z>2)Z=2;let R=m0(C,M,Q),I=new Uint16Array(R);j0.default(I,M,Q,Z);let A=U/100*4096+0.5|0,L=j<<8,B=M*Q;for(let y=0;y<B;y++)if(q=R[y],J=q-I[y],Math.abs(J)>=L)K=q+(A*J+2048>>12),K=K>65280?65280:K,K=K<0?0:K,q=q!==0?q:1,G=(K<<12)/q|0,$=y*4,C[$]=C[$]*G+2048>>12,C[$+1]=C[$+1]*G+2048>>12,C[$+2]=C[$+2]*G+2048>>12}function L0(C,M,Q,U,Z,j,q,K,G,J,$,R,I){let A=K0(C,M,Q,U,Z,j,q,K,G,J);if($)R0(A,Z,j,$,R,I);return A}var P0=(C,M,Q,U,Z,j,q)=>{let K=s(C,M),G=L0(Q,K,C.width,C.height,C.toWidth,C.toHeight,C.scaleX,C.scaleY,C.offsetX,C.offsetY,U,Z,j);e(C,G,q)};async function I0(C,M,Q,U,Z,j,q,K){let G=M.getContext("2d");if(!G)throw new Error("Pica: Canvas context is not supported");let J=t(C.width,C.height,Q,M.width,M.height,U);for(let $ of J)P0($,C,Z,j,q,K,G)}async function k0(C,M,Q,U,Z,j,q,K){let G=M,J=new OffscreenCanvas(C[0].toWidth,C[0].toHeight);for(let $=0;$<C.length;$++){await I0(G,J,Q,U,Z,j,q,K);let R=C[$+1];if(!R)break;G=J,J=new OffscreenCanvas(R.toWidth,R.toHeight)}return J}async function B0(C,M){let Q=M.maxDimension,U=M.tileSize||1024,Z=M.filter||"mks2013",j=M.unsharpAmount||0,q=M.unsharpRadius||0,K=M.unsharpThreshold||0,G=await createImageBitmap(C),J=G.width,$=G.height,R=Q/J,I=Q/$,A=Math.min(R,I,1),L=Math.floor(J*A),B=Math.floor($*A),y=3,E=Math.ceil(Math.max(3,2.5*q|0)),k=l(J,$,L,B,U,E);return(await k0(k,G,U,E,Z,j,q,K)).transferToImageBitmap()}self.onmessage=async(C)=>{let{taskId:M,blob:Q,options:U}=C.data;try{let Z=await B0(Q,U);self.postMessage({taskId:M,output:Z},[Z])}catch(Z){self.postMessage({taskId:M,error:Z})}};
`,bk=new Blob([Pk],{type:"application/javascript"}),Hk=(()=>{let k=0;return()=>++k})();class yk{#M;#C;#Q;#k;constructor(){this.#M=new Map,this.#C=new Map,this.#Q=new Map,this.#k=new Map}get count(){return this.#M.size}setWorkerTimeout(k,M){let U=setTimeout(()=>{let C=this.#M.get(k);if(C)this.#Q.delete(C);if(C)this.#k.delete(C);this.#C.delete(k),this.#M.delete(k),k.terminate()},M);this.#C.set(k,U)}clearWorkerTimeout(k){clearTimeout(this.#C.get(k))}addWorker(k){this.#M.set(k,null)}getWorker(k){return this.#Q.get(k)}getTask(k){return this.#k.get(k)}getAvailableWorker(){for(let[k,M]of this.#M.entries())if(M===null)return k;return null}assignTask(k,M){this.#M.set(k,M.id),this.#Q.set(M.id,k),this.#k.set(M.id,M);let U={taskId:M.id,blob:M.data.blob,options:M.data.options};k.postMessage(U)}removeTask(k){let M=this.#Q.get(k);if(M)this.#M.set(M,null);this.#Q.delete(k),this.#k.delete(k)}}class c{#M;#C;#Q;#k;constructor(k,M){this.#C=k,this.#M=M,this.#Q=[],this.#k=new yk}#q(){let k=new Worker(URL.createObjectURL(bk));k.onmessage=(M)=>{let{taskId:U,output:C,error:J}=M.data,$=this.#k.getWorker(U),Q=this.#k.getTask(U);if(J){if(Q)Q.reject(J)}else if(Q)Q.resolve(C);if(this.#k.removeTask(U),$)this.#k.setWorkerTimeout($,this.#M);this.#U()},k.onerror=(M)=>{console.log(M.message),console.log(M)},this.#k.addWorker(k)}#U(){let k=this.#k.getAvailableWorker();if(k){let M=this.#Q.shift();if(M)this.#k.assignTask(k,M),this.#k.clearWorkerTimeout(k)}else if(this.#k.count<this.#C)this.#q(),this.#U()}addTask(k){return new Promise((M,U)=>{this.#Q.push({id:Hk(),data:{blob:k.blob,options:k.options},resolve:M,reject:U}),this.#U()})}}class uk{#M;#C;constructor(k){let M=typeof navigator==="undefined"?1:navigator.hardwareConcurrency,U=k.maxWorkerPoolSize||Math.min(M,4),C=k.maxWorkerIdleTime||2000;this.#M=new c(U,C),this.#C=k}squish(k,M){let U=M?{...this.#C,...M}:this.#C;if(U.useMainThread)return Bk(k,U);return this.#M.addTask({blob:k,options:U})}}export{uk as PicSquish};
